From 42351e1f3cc0d30f5b3f425ab7d2d8ca15d07bbf Mon Sep 17 00:00:00 2001
From: Zhu Yanhai <gaoyang.zyh@taobao.com>
Date: Mon, 17 Dec 2012 14:58:36 +0800
Subject: [PATCH] kernel module: enable force kernel module signature

 To protect against accidentally-corrupted modules causing damage (e.g Systemtap),
 we enable force kernel module signature here.

Patch-mainline: already
References: http://lwn.net/Articles/470906/

Signed-off-by: Zhu Yanhai <gaoyang.zyh@taobao.com>
Acked-by: 

diff --git a/crypto/signature/key.h b/crypto/signature/key.h
index 1a2b1ae..d3a8afe 100644
--- a/crypto/signature/key.h
+++ b/crypto/signature/key.h
@@ -1,76 +1,41 @@
 const char ksign_def_public_key[] __initdata=
-	"\x99\x01\xa2\x04\x4d\xff\x83\x88\x11\x04\x00\xda\xc3\xb6\x9e\xe1"
-	"\x4e\xb3\x48\x8f\xa5\x55\x62\x83\x0a\x75\x6e\xd0\x81\x69\x6f\x87"
-	"\x8c\xc7\x22\x3e\x14\xe1\x57\xc4\xbb\xd1\x66\x36\x8f\x45\x05\xd3"
-	"\x0f\x25\x3f\xc8\x0c\xdd\x5b\xed\x47\xdb\x3d\xaf\xe4\x5c\x45\x5d"
-	"\xbe\x7f\xeb\x5f\x82\x2f\xc4\x89\x36\xb0\x65\x52\x00\xb9\x6e\x5d"
-	"\x2b\xba\xb9\x22\xaa\xb3\x79\x96\x3e\x69\x61\x8c\x02\xed\xe9\xab"
-	"\x67\x37\x6a\xe1\xc4\xcc\x1b\x13\x15\x23\xea\x56\x2f\xca\x6e\xcb"
-	"\x6b\x19\x0d\x2d\x87\x05\xd3\xb3\x82\xc9\x3d\x49\x86\x35\xf5\xf5"
-	"\x55\x36\xb1\x5a\x74\x0b\x54\x5d\x62\x59\x57\x00\xa0\xcb\x29\x24"
-	"\x26\xee\x8b\xe7\x78\xa5\x0e\x04\x3c\xc5\x8b\x8f\xb6\x4e\xf7\xc0"
-	"\x2d\x03\xfe\x2c\x66\xd6\x52\xfc\xfb\x2d\x07\xab\x4b\x62\x54\x91"
-	"\x8b\xd2\x91\x7a\xd4\xce\x1d\x09\x15\xa6\x95\x72\x18\xe2\x31\xf6"
-	"\xc7\x93\xdf\x60\xc7\x1a\x6f\x6b\x6a\xb2\x83\xc8\x4d\x5d\x54\x34"
-	"\x33\x53\x4f\x61\xc1\xd9\x83\xbf\xfd\x3d\x85\xd8\xe5\x57\x24\x47"
-	"\xae\xfa\x5f\xd6\x14\x03\x19\x8a\xfc\x73\x42\x74\xaa\x38\xaa\xea"
-	"\x09\x7f\xc7\xca\x44\x35\xd5\x1a\x2b\x25\xca\x52\xec\xd5\x2f\x0f"
-	"\x5d\xb5\x70\x44\x9b\x6e\xa7\x4e\x89\xc7\xc7\xf3\xc8\x83\x1e\xe6"
-	"\x32\x0b\x5a\x90\x67\xc2\x6d\x7b\x31\x6a\x24\xf6\x90\x94\x54\x9f"
-	"\x21\x17\x42\x03\xff\x49\x00\xf2\xbf\xa9\x5a\x33\x2c\xf0\x01\xb5"
-	"\x0e\x73\x4e\x9d\xd7\x51\x0f\xe3\x76\xc1\x4d\x80\x24\x6c\x4c\x93"
-	"\xeb\x5d\xe4\x1a\x79\xd1\x5f\xe7\x5f\xb6\x4d\xe3\xd8\xca\x87\xe7"
-	"\xaa\x3b\xfc\x2c\xa2\x04\xcc\xe0\x9c\x86\x54\x90\x9b\x2e\xe0\x2c"
-	"\xac\xde\x96\x7c\x06\x0b\x59\x6c\xc0\xbc\x3a\x42\x5b\x52\x70\x5d"
-	"\x1b\xff\x26\x5f\xd1\x0e\x0e\x06\x65\xf9\x4d\x40\x69\x75\xca\xce"
-	"\x99\x81\x99\x7f\x08\x70\x60\x80\x68\x9c\xc4\x23\xe7\x1f\x4c\x62"
-	"\x2e\xf4\x90\xc6\x4d\x34\xb1\xb4\x3b\x98\x0b\x9c\xe4\xde\x66\x05"
-	"\xf4\xdc\x80\x09\x71\xb4\x25\x52\x65\x64\x20\x48\x61\x74\x2c\x20"
-	"\x49\x6e\x63\x2e\x20\x28\x4b\x65\x72\x6e\x65\x6c\x20\x4d\x6f\x64"
-	"\x75\x6c\x65\x20\x47\x50\x47\x20\x6b\x65\x79\x29\x88\x60\x04\x13"
-	"\x11\x02\x00\x20\x05\x02\x4d\xff\x83\x88\x02\x1b\x23\x06\x0b\x09"
-	"\x08\x07\x03\x02\x04\x15\x02\x08\x03\x04\x16\x02\x03\x01\x02\x1e"
-	"\x01\x02\x17\x80\x00\x0a\x09\x10\x0c\xba\x5a\x3f\x3e\x49\x43\x81"
-	"\xdd\xc1\x00\xa0\xc4\x86\x08\x4d\x90\x96\x8c\x2c\x52\xc1\xe4\x7c"
-	"\x75\x89\x67\x1b\x83\x72\x90\x1d\x00\x9f\x65\x8b\xf2\xe5\x22\xd7"
-	"\x0d\x75\x01\x91\x66\xfb\xcb\xa2\x16\x69\x52\x55\x1e\x1e\x99\x01"
-	"\xa2\x04\x4b\x9f\x60\x5c\x11\x04\x00\xe8\x9d\xf7\xee\xa1\x42\x33"
-	"\x6c\x33\xfa\x4e\x08\xca\x23\xd0\xd1\x60\x16\xb1\x6a\x7f\x61\xad"
-	"\xe1\xc7\x63\x81\xe3\xc8\xfc\xac\xe9\xa3\x38\x7e\x16\x3a\x33\x7f"
-	"\xfd\x04\x10\x76\xd8\x83\x77\x8d\x37\x53\x95\x61\x1d\xaf\x3c\xc9"
-	"\xc3\x30\xff\x69\x83\xb0\x70\xa9\x44\xfb\xee\xab\x8a\x04\xdb\x2a"
-	"\xfd\xee\xe2\x89\x2c\xab\x3a\xf9\x7a\x7b\x04\xd8\x4a\x14\x1f\x78"
-	"\x4c\xc2\xf9\xf3\xc8\xe2\x7a\x0f\xde\xef\x96\xe0\x61\xb1\xbc\x4c"
-	"\xec\x08\xf4\x5a\x94\x6f\x26\x31\xf1\xea\x73\x99\xae\x34\xd9\xb1"
-	"\x23\x20\x64\x53\x03\xf2\xeb\x68\x13\x00\xa0\x9d\xe8\xbb\x78\x16"
-	"\xfd\x70\xff\x87\x95\xf5\x8e\xe0\xcd\x6c\x74\x82\x09\x57\x2d\x04"
-	"\x00\x9e\x25\x32\x03\x39\x27\xd0\x12\x11\xb9\x3a\x13\x23\x7d\xb4"
-	"\xb0\x50\x8d\x23\xfd\xf4\x00\x98\x68\x93\xa9\xa1\x06\x0d\x6e\x2f"
-	"\x3b\xca\x42\xbd\xb7\xac\xcc\xea\x26\x7e\x8e\xc2\x73\xfc\x44\xc4"
-	"\xfc\xd0\xdb\x9a\xcc\xed\xe3\x97\x47\x24\xbd\x59\xc1\x39\x6f\xac"
-	"\x8b\xf4\xd8\xd3\xfb\x57\xfb\x65\x9e\x1a\x7d\x69\x19\x2a\xcd\x77"
-	"\x87\xdd\xb1\x49\x4b\x94\x76\x71\x4c\xc5\x5d\x35\xe8\x5c\xc7\x4d"
-	"\x99\xf8\x23\x19\x4f\x77\x3e\x63\xab\xee\x02\x32\xc5\x78\x61\x0d"
-	"\x14\x6d\x13\x7a\x69\x51\xf4\xd3\x1b\xd5\x34\x17\x11\x15\xe8\x0d"
-	"\xb0\x03\xfe\x30\xf1\x34\x14\x74\xbf\x53\xef\x20\xac\x6e\xc4\x8e"
-	"\x82\xc1\x3a\x1a\x55\x65\x6a\x97\x6a\x3b\x0f\x39\x00\x53\x15\x29"
-	"\xa0\xf0\xe2\xe1\xf8\x3a\x9a\xb7\x71\xce\x8b\x13\xa9\xc1\xfb\xb7"
-	"\xa1\x13\xb8\x4f\xac\xfd\x91\xd8\x57\xa0\x02\x85\x76\x88\xf8\x37"
-	"\xc9\x79\x7f\xe9\x69\xe5\x85\x01\x7f\xe1\x83\xf4\x0b\xcc\xcf\xf8"
-	"\xc5\x20\x4a\xb5\x05\x07\x54\xd0\x1f\x64\x15\x35\xe9\xb3\xdc\xf4"
-	"\xe7\x36\x44\xe0\xc0\x68\x9c\xa4\x02\xa3\x79\xe7\xe2\xb9\x01\xa0"
-	"\x98\x0d\xc2\xf5\x3b\x4a\x08\x4a\x8e\xb3\x1b\xe9\xa4\x9e\x85\x33"
-	"\x04\xd3\x98\xb4\x44\x52\x65\x64\x20\x48\x61\x74\x20\x45\x6e\x74"
-	"\x65\x72\x70\x72\x69\x73\x65\x20\x4c\x69\x6e\x75\x78\x20\x44\x72"
-	"\x69\x76\x65\x72\x20\x55\x70\x64\x61\x74\x65\x20\x50\x72\x6f\x67"
-	"\x72\x61\x6d\x20\x3c\x73\x65\x63\x61\x6c\x65\x72\x74\x40\x72\x65"
-	"\x64\x68\x61\x74\x2e\x63\x6f\x6d\x3e\x88\x60\x04\x13\x11\x02\x00"
-	"\x20\x05\x02\x4b\xe9\x39\x1c\x02\x1b\x03\x06\x0b\x09\x08\x07\x03"
-	"\x02\x04\x15\x02\x08\x03\x04\x16\x02\x03\x01\x02\x1e\x01\x02\x17"
-	"\x80\x00\x0a\x09\x10\xd4\xa2\x6c\x9c\xcd\x09\xbe\xda\xc6\xa6\x00"
-	"\x9e\x33\x63\x02\x64\x37\xe3\x19\x36\x54\xf4\xcb\x60\xb1\xd8\xe9"
-	"\x71\x35\x7a\xb8\xd1\x00\x9e\x3f\x4d\xca\xbf\xf6\x1f\x15\x34\x4e"
-	"\x04\x5d\x62\xcd\x5c\x8a\x11\x53\xe3\x01\x1a"
+	"\x99\x01\xa2\x04\x50\xce\x94\xf9\x11\x04\x00\xaf\x27\x79\x64\x52"
+	"\x2e\x4f\x8a\x30\xd4\x37\xdc\xb6\xa1\x04\x10\x97\x5f\x7a\xae\xa6"
+	"\xa9\xe7\x6e\xa1\x29\x30\x0b\x94\x3c\x87\x0b\xc4\x4b\xf8\x9b\xdd"
+	"\xac\x64\x41\xbe\xe4\xb3\xc9\xf0\x0e\xd6\x8c\xcf\x02\xf3\x7d\x6d"
+	"\x83\x88\x18\xa9\x20\xbe\x2b\x2f\x34\x2b\xd7\x7f\xe9\x70\xf7\x2e"
+	"\xa6\x20\x93\xb5\x3f\x31\x1c\x13\x92\x55\x33\x0a\xd6\xc0\x2c\xd8"
+	"\xf8\xc2\x82\x2d\x2a\x87\xeb\xa2\x92\x83\x9c\x12\xc5\x11\xae\xe1"
+	"\xa3\x8e\x84\x9c\x8d\xda\xa0\x1d\x25\x21\xfc\xfa\xc5\x1a\x5b\x26"
+	"\xed\x90\x5d\x30\xc1\x04\xe6\xa9\x86\x15\xb3\x00\xa0\xe5\xe0\xcf"
+	"\xd0\x9b\x12\xb8\x40\x3b\xc0\xf4\xe6\xe5\xe2\xab\x90\x01\x4e\x37"
+	"\x3b\x04\x00\xa4\x94\x5c\xf4\x0d\x16\x8d\x88\x90\x8a\x5e\x86\x54"
+	"\xde\xb1\x16\xf1\x30\xba\x38\x70\x6c\xa0\xf5\xe6\x02\x59\xb6\x3a"
+	"\x8b\x64\x6f\x40\x29\x8d\x97\x86\x1c\x12\x66\x06\x6e\xf6\x5d\xb0"
+	"\xfb\x5a\x80\xea\xb4\x2e\x5d\xbe\x60\xfe\xd4\xb7\x85\x33\xd4\x14"
+	"\x5a\xa3\x27\xd2\x66\xc2\x1e\xac\xe6\xaf\x48\xc2\x4e\xcf\xff\x51"
+	"\x5a\x01\xe0\xfe\x3f\x9a\xad\x36\xf6\xed\x6b\x0b\x69\xf8\x1e\xfb"
+	"\x47\xcf\xbe\xd5\x62\x9d\x74\x26\x4a\x06\x15\x91\x6e\x46\x2c\x34"
+	"\x3e\x54\x1b\xaa\x0b\x75\x8b\xcd\xf3\x6d\xb7\x10\x0c\x96\x50\x97"
+	"\x50\x30\x48\x03\xfe\x26\x91\x85\x97\x61\x4e\xa8\x7f\xdd\x09\x7e"
+	"\xeb\x7a\xa8\x7d\x69\x51\xca\x6d\x94\x09\xd1\xd1\x29\x8f\xb5\x46"
+	"\xa1\x90\xf2\x3c\x1b\x2a\xab\x1f\xdc\x73\x3c\x6a\x8c\xcd\x33\x01"
+	"\x76\xce\xbf\x63\x99\xc5\x97\xbe\x5d\xbc\xdb\x79\x93\xaf\x88\x3f"
+	"\xbb\x6c\x6b\x6b\xa6\x7c\xd2\x72\x4c\x8d\x3e\x56\xb7\x1d\x22\xb5"
+	"\x21\xa4\x1f\x8d\x16\x8d\x33\x09\x60\x97\xe6\xf8\x72\x01\xa7\x66"
+	"\x59\x27\x16\x63\x56\x52\x7a\x96\x1b\x01\x66\xf6\x0b\x42\x83\xe6"
+	"\x17\x67\x0e\x81\x51\xff\x42\xc5\x23\xa2\xa7\xb8\x37\x36\x46\xd0"
+	"\x24\x0a\x03\x51\x62\xb4\x3b\x54\x34\x6b\x65\x72\x6e\x65\x6c\x20"
+	"\x28\x54\x34\x6b\x65\x72\x6e\x65\x6c\x20\x4d\x6f\x64\x75\x6c\x65"
+	"\x20\x47\x50\x47\x20\x6b\x65\x79\x29\x20\x3c\x67\x61\x6f\x79\x61"
+	"\x6e\x67\x2e\x7a\x79\x68\x40\x74\x61\x6f\x62\x61\x6f\x2e\x63\x6f"
+	"\x6d\x3e\x88\x60\x04\x13\x11\x02\x00\x20\x05\x02\x50\xce\x94\xf9"
+	"\x02\x1b\x23\x06\x0b\x09\x08\x07\x03\x02\x04\x15\x02\x08\x03\x04"
+	"\x16\x02\x03\x01\x02\x1e\x01\x02\x17\x80\x00\x0a\x09\x10\xd8\x24"
+	"\xdc\xc6\x02\x90\x0a\x95\x0b\xc6\x00\x9e\x25\x85\xb9\xc0\x59\x95"
+	"\x86\xc0\x6c\x03\x38\x58\x83\xd7\xad\xa9\x03\x5c\x61\x60\x00\x9e"
+	"\x23\x99\x68\xd7\x98\xd9\xe4\xf8\xac\x1e\x80\x9b\x0e\xc0\x64\xe9"
+	"\x5e\x64\x26\xd9"
 	;
 
-const int ksign_def_public_key_size = 1147;
+const int ksign_def_public_key_size = 580;
diff --git a/scripts/Makefile.modpost b/scripts/Makefile.modpost
index 7665cf4..dbf2175 100644
--- a/scripts/Makefile.modpost
+++ b/scripts/Makefile.modpost
@@ -160,11 +160,6 @@ else
 SIGN_MODULES := 0
 endif
 
-# only sign if it's an in-tree module
-ifneq ($(KBUILD_EXTMOD),)
-SIGN_MODULES := 0
-endif
-
 ifeq ($(SIGN_MODULES),1)
 quiet_cmd_sign_ko_ko_unsigned = SIGN [M] $@
       cmd_sign_ko_ko_unsigned = \
-- 
1.7.4.1

